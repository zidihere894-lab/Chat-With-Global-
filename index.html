<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat With Global | Ultimate</title>
    <style>
        :root {
            --bg: #121b22; 
            --card: #1f2c33;
            --neon: #00a884; 
            --shadow: #0a1014;
            --light: #2a3942;
        }
        body { background: var(--bg); color: #e9edef; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .app-container { max-width: 450px; margin: auto; min-height: 100vh; display: flex; flex-direction: column; }

        /* Top UID Box */
        .top-uid-box {
            background: var(--bg); margin: 20px; padding: 15px; border-radius: 20px;
            box-shadow: 8px 8px 16px var(--shadow), -8px -8px 16px var(--light);
            text-align: center; border: 1px solid var(--light);
        }
        .top-uid-box span { display: block; font-size: 10px; color: #8696a0; text-transform: uppercase; }
        .top-uid-box strong { font-size: 22px; color: var(--neon); letter-spacing: 2px; }

        /* Tabs/Navigation */
        .tab-bar { display: flex; justify-content: space-around; padding: 10px; background: var(--card); border-bottom: 1px solid var(--light); }
        .tab { cursor: pointer; color: #8696a0; font-weight: bold; padding: 10px; transition: 0.3s; }
        .tab.active { color: var(--neon); border-bottom: 2px solid var(--neon); }

        /* Contact Section */
        .section { padding: 15px; display: none; }
        .section.active { display: block; }
        .btn-add {
            background: var(--neon); color: #000; border: none; padding: 12px;
            border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-bottom: 20px;
        }

        /* List Styling */
        .user-card {
            display: flex; align-items: center; padding: 12px; background: var(--bg);
            margin-bottom: 12px; border-radius: 15px; 
            box-shadow: 5px 5px 10px var(--shadow), -5px -5px 10px var(--light);
        }
        .user-card img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--neon); margin-right: 15px; }
        .user-info b { display: block; font-size: 15px; }
        .user-info small { color: #8696a0; font-size: 11px; }

        /* Login Screen */
        #login-screen { height: 100vh; display: flex; justify-content: center; align-items: center; background: var(--bg); }
        .login-btn { 
            background: var(--bg); color: white; border: none; padding: 15px 30px; 
            border-radius: 20px; box-shadow: 10px 10px 20px var(--shadow), -10px -10px 20px var(--light);
            font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="login-screen">
    <button class="login-btn" onclick="login()">ðŸš€ Login with Google</button>
</div>

<div id="main-app" class="app-container" style="display:none;">
    <div class="top-uid-box">
        <span>Your Personal UID</span>
        <strong id="my-uid-display">ZID-00000000</strong>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="switchTab('contacts', this)">CONTACTS</div>
        <div class="tab" onclick="switchTab('global', this)">GLOBAL</div>
    </div>

    <div id="contacts" class="section active">
        <button class="btn-add" onclick="addContactPrompt()">+ Add New Contact</button>
        <div id="contacts-list">
            <p style="text-align:center; color:#555;">No saved contacts yet.</p>
        </div>
    </div>

    <div id="global" class="section">
        <div id="global-list">
            </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyCFy28nNtxhkjfpOd0aCfYkjHUwErh1WVQ",
      authDomain: "movie-1e6fc.firebaseapp.com",
      projectId: "movie-1e6fc",
      databaseURL: "https://movie-1e6fc-default-rtdb.firebaseio.com",
      storageBucket: "movie-1e6fc.firebasestorage.app",
      messagingSenderId: "371616954594",
      appId: "1:371616954594:web:977d88ec7570df351246bb"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).then(res => {
            const u = res.user;
            const userRef = db.ref('users/' + u.uid);
            
            userRef.once('value', snap => {
                let data = snap.val();
                if(!data) {
                    const newUID = 'ZID-' + Math.floor(10000000 + Math.random() * 90000000);
                    data = { name: u.displayName, photo: u.photoURL, uid: u.uid, ziddi_id: newUID, status: 'active' };
                    userRef.set(data);
                }
                
                currentUser = data;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                document.getElementById('my-uid-display').innerText = data.ziddi_id;
                
                loadGlobalList();
                loadSavedContacts();
            });
        });
    }

    function switchTab(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    // Load All Registered Users (Global Tab)
    function loadGlobalList() {
        db.ref('users').on('value', snap => {
            const list = document.getElementById('global-list');
            list.innerHTML = "";
            snap.forEach(child => {
                const u = child.val();
                if(u.uid !== currentUser.uid) {
                    list.innerHTML += `
                        <div class="user-card">
                            <img src="${u.photo}">
                            <div class="user-info">
                                <b>${u.ziddi_id}</b>
                                <small>Registered Member</small>
                            </div>
                        </div>`;
                }
            });
        });
    }

    // Add Contact via UID
    function addContactPrompt() {
        const uid = prompt("Enter Member's 8-Digit UID (e.g., ZID-12345678):");
        const nickname = prompt("Enter Name to Save:");
        if(uid && nickname) {
            db.ref('contacts/' + currentUser.uid).push({ uid: uid, nickname: nickname });
            alert("Contact Saved!");
        }
    }

    // Load Saved Contacts
    function loadSavedContacts() {
        db.ref('contacts/' + currentUser.uid).on('value', snap => {
            const list = document.getElementById('contacts-list');
            list.innerHTML = "";
            if(!snap.exists()) {
                list.innerHTML = "<p style='text-align:center; color:#555;'>No saved contacts.</p>";
                return;
            }
            snap.forEach(child => {
                const c = child.val();
                list.innerHTML += `
                    <div class="user-card" onclick="alert('Starting chat with ${c.nickname}...')">
                        <div class="user-info">
                            <b>${c.nickname}</b>
                            <small>${c.uid}</small>
                        </div>
                    </div>`;
            });
        });
    }
</script>
</body>
</html>
